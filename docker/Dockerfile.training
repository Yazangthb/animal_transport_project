FROM nvidia/cuda:11.6.2-runtime-ubuntu20.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    python3 python3-pip git wget && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY docker/requirements.txt /app/requirements.txt

# Install PyTorch CUDA 11.6
RUN pip3 install torch==2.0.1+cu116 torchvision==0.15.2+cu116 torchaudio==2.0.2 \
    -f https://download.pytorch.org/whl/cu116/torch_stable.html

RUN pip3 install --no-cache-dir -r requirements.txt

ENV HF_HOME=/app/hf_cache

COPY train /app/train
COPY api/rules.py /app/api/rules.py

ENV REASONING_MODEL_NAME=Qwen/Qwen2.5-7B-Instruct

WORKDIR /app/train

CMD ["bash"]
